# HTTP cookies

```text

HTTP cookies
    cookies
        represents particular client
        indicates that client has made a request to server before

HTTP cookies - notes from reading
    A.K.A
        cookies
        web cookies
        browser cookies
        Internet cookies
    whats
        what problem does it solve
            enables stateful communication over HTTP
                enables servers to store stateful information on their clients
                    tracking user activities
                        record
                            clicked buttons
                            logging in
                            visited pages
                            form fields
        what the security of it depends on
            issuing website
            user agent
    where
        generated by servers
        stored on client
    how use
        sent back from client to server
        interpreted by server
    classification
        session cookie
            A.K.A
                in-memory cookie
                transient cookie
                non-persistent cookie
            stored in RAM while user navigates a website
            deleted when browser is closed
            no expiry time specified
        persistent cookie
            A.K.A
                tracking cookies
            expiry date is assigned
        secure cookie
            can only be trasmitted over an encrypted connection
                HTTPS
                syntactical indication
                    flag
                        Secure
        HTTP-only cookie
            cannot be accessed by client-side APIs
                JavaScript
            eliminates threat
                cookie theft via Cross-site scripting
            syntactical indication
                flag
                    HttpOnly
        same-site cookie
            syntactical indication
                flag
                    SameSite
                        values
                            SameSite=Strcit
                                user agents would send cookie
                                    only to its originating domain
                                mitigates cross-site request forgery
                            SameSite=Lax
                                user agents would send cookie
                                    even if the target domain is different from its originating domain
                                        BUT only for safe requests
                                            GET
                                        AND NOT third-party cookie
                            SameSite=None
                                user agents would send
                                    third-party cookies
                                most browsers require Secure flag to use
        third-party cookie
            domain flag is set to a domain which is different from the cookie's originating domain
            saved on browser when user visits a website which features resources from other domain
            use case
                user tracking
                    tracker can track target's activity on sites that features the trackers resource
                        with the use of HTTP referer header field
                    from the tracker's perspective, sites that features their resource is their teritory
        supercookie
            cookie with origin of top-level domain
            ordinary cookies have an origin of second level domain
        cookie wall
            a notification that indicates the use of cookies
                specifically those that does not provide an option to reject it
            the user's consent to the use of cookies acts like a wall between the user and the resource that is being requested
        authentication cookie
            used by
                servers to authenticate that a user is logged in
                    and with which account
                flow of cookie based authentication
                    client
                        does not have a session at this point
                        makes request to server to get protected resource
                            request target URL of this request becomes
                                __original__ request target URL
                    sever
                        receives request asking for protected resource
                        creates a new session
                        generates a SID
                        associate the SID to the new session
                        inserts SID into response header
                        sends
                            the location of login page
                            SID in response header
                    client
                        recieves response indicating redirection
                        saves received SID on client's disk
                        inserts
                            entered credentials in request body
                            SID in request header
                        makes request to authenticate itself
                    server
                        receives request
                            asking for authentication
                            contains SID in header
                        using received SID, tries to find corresponding session in session store
                        using the received credentials, tries to retrieve a user record out of persistent data store
                        if ___ is found
                            ___
                                a user record
                                    that matches received credentials
                                session
                                    that has the same SID as the received SID
                            associates user identifer with current session and
                                saves it in session store
                            inserts in response header
                                location of "original request target"
                                SID of current session
                            sends response
                        else
                            inserts
                                location of login page in response header
                                SID of current session
                            sends response
                    client
                        if successfully authenticatd in previous request
                            receives response that
                                indicates redirection to original request target URL
                                contains SID
                            saves SID on client's disk
                            inserts in request header
                                original request target URL
                                received SID
                            sends request to get the originally requested, protected resource
                        else
                            receives response that
                                indicates redirection to login page
                                contains SID
                            saves SID on client's disk
                            inserts in request header
                                URL of login page
                                received SID
                            sends request to get login page
                    server
                        either
                            A
                                receives request
                                    asking for protected resource
                                    contains SID
                                using received SID, tries to find corresponding session in session store
                                if a session is found
                                    validate association of session and user record in persistent data store
                                        specifically
                                            use the user identifier as a key to find a user record in persistent data store
                                    if a session is associated with a user record
                                        specifically
                                            if a user record is found
                                        insert to request body
                                            protected resource
                                        insert to request header
                                            SID
                                        send response to client
                                    else
                                        insert to response header
                                            location of login page
                                            SID
                                        send respnose to client
                            B
                                receives request
                                    asking for login page
                                    contains SID
                                ...
    structure
        components
            name=value pair
            attributes
                zero or more of them
                name=value pairs
                examples
                    Secure
                    HttpOnly
                    SameSite
    use cases
        session management
            establishing and maintain stateful communication
                flow
                    user
                        visits webiste's login page
                        client
                            makes request to server
                    server
                        receives request
                            which asks server to send login form
                        creates session
                            create session token
                                generate unique session identifier
                                associate session identifer with the particular user's activity on website
                        send session identifier to client
                            in the form of HTTP cookie header field
                    browser
                        downloads and renders login page
                        receives and saves session identifier on client's disk
                            in the form of cookie
                        sends login credentials along with session identifer to server
                    server
                        receives request
                            which asks server to authenticate the request
                                before providing access to protected resource
                        authenticates user
                            using received credentials
                        upon successful authentihcation
                            associates user identity data with received session identifier
                                and stores it in a database
            server should regenerate and send new session cookies whenever authentication takes [place](place)
        personalization
            a use case of session management
            examples
                user preferences
        tracking
            recording and analyzing user behavior
    implementation
        requirements for browsers to support cookies
            can support
                cookies as large as 4096 bytes
                at least
                    50 cookies per domain
                    3000 cookies in total
        cookies are set by
            servers
                HTTP header field
                    Set-Cookie: <cookie name>=<value>; attribute=value; attribute
                        sent in an HTTP response from server
                        instructs browser to
                            ___ cookie ___
                                store, on client's computer
                                send back, to server in future requests to server
                cookies can only be set on current resource's top domain and its subdomains
                    security reasons
                        not conforming to this would allow the issuer to have control over other domain's cookies
            clients
                JavsScript
                    document.cookie = "key=value"
            example request-response cycle
                where a server instructs browser to
                    save cookie on client's computer
                    send cookie to server with successive requests to server
                    request header
                        GET /index.html HTTP/1.1
                        Host: www.example.com
                    response header
                        HTTP/1.1 200 OK 
                        Content-type: text/html
                        Set-Cookie: theme=dark
                        Set-Cookie: sessionToken=abc123; Expires=Wed, 09 Jun 2021 10:18:14 GMT
                    request header
                        GET /spec.html HTTP/1.1
                        Cookie: theme=dark; sessionToken=abc123
        cookie attributes
            how used
                not included in requests by user agents
            who they're used by
                user agents
                    determine
                        when to delete cookie
                        block cookie
                        whether to send cookie
            Domain and Path
                defines scope of cookie
                    indicatese what website the cookie belongs to
                if set
                    user agent would send cookie to its issuing domain AND its subdomains
                if not explicitly set
                    defaults to the domain and path of the requested resource
                        will act as host-only cookie
                            user agent would only send cookie to its issuing domain
            Expires and Max-Age
                Expires
                    defines specific date and time for when to delete cookie
                Max-Age
                    defines expiration of cookie as interval of seconds in the future
                        relative to the time the user agent received the cookie
            Secure and HttpOnly
                does not have associated values
                    presence of just these attribute indicates that their behaviors should be enabled
                Secure
                    directs user agents to use cookies only via encrypted connection
                        HTTPS
                    if a Secure cookie is set via non-encrypted connection, it can be intercepted
                        Secure attribute should be set over an encrypted connection
                HttpOnly
                    directs user agents not to expose cookies through channels other than HTTP and HTTPS
                        disables access to cookies by client-side scripting languages

```

## Resources

- [HTTP | MDN](https://developer.mozilla.org/en-US/docs/Web/HTTP)
- [HTTP State Management Mechanism | RFC](https://datatracker.ietf.org/doc/html/rfc6265)
